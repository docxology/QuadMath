% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames*,x11names*}{xcolor}
%
\documentclass[
  10pt,
]{article}
\usepackage{lmodern}
\usepackage{setspace}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
  \setmainfont[]{DejaVu Serif}
  \setmonofont[]{DejaVu Sans Mono}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  colorlinks=true,
  linkcolor=red,
  filecolor=red,
  citecolor=red,
  urlcolor=red,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage[margin=1cm,top=1cm,bottom=1cm,left=1cm,right=1cm,includeheadfoot]{geometry}
\usepackage{listings}
\newcommand{\passthrough}[1]{#1}
\lstset{defaultdialect=[5.3]Lua}
\lstset{defaultdialect=[x86masm]Assembler}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{3}
% Enable graphics inclusion and ensure figure numbering works
\usepackage{graphicx}
\renewcommand{\figurename}{Figure}

% Configure fonts for Unicode support with fallbacks
\usepackage{newunicodechar}
\newunicodechar{⁴}{\textsuperscript{4}}
\newunicodechar{₄}{\textsubscript{4}}

% Enhanced code block styling for better contrast and readability
\usepackage{fancyvrb}
\usepackage{xcolor}
\usepackage{listings}

% Define custom colors for code blocks
\definecolor{codebg}{RGB}{245, 245, 245}      % Light gray background
\definecolor{codeborder}{RGB}{200, 200, 200}  % Medium gray border
\definecolor{codefg}{RGB}{50, 50, 50}         % Dark gray text

% Configure Verbatim environment for inline code
\DefineVerbatimEnvironment{Verbatim}{Verbatim}{%
    fontsize=\small,
    frame=single,
    framerule=0.5pt,
    framesep=3pt,
    rulecolor=\color{codeborder},
    bgcolor=\color{codebg},
    fgcolor=\color{codefg}
}

% Configure code block styling
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{%
    fontsize=\footnotesize,
    frame=single,
    framerule=0.5pt,
    framesep=5pt,
    rulecolor=\color{codeborder},
    bgcolor=\color{codebg},
    fgcolor=\color{codefg}
}

% Style inline code with \texttt
\renewcommand{\texttt}[1]{%
    \colorbox{codebg}{\color{codefg}\ttfamily #1}%
}

% Configure listings package for code blocks
\lstset{
    backgroundcolor=\color{codebg},
    basicstyle=\footnotesize\ttfamily\color{codefg},
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    commentstyle=\color{codefg},
    deletekeywords={...},
    escapeinside={\%*}{*)},
    extendedchars=true,
    frame=single,
    framerule=0.5pt,
    framesep=5pt,
    keepspaces=true,
    keywordstyle=\color{codefg},
    language=Python,
    morekeywords={*,...},
    numbers=left,
    numbersep=5pt,
    numberstyle=\tiny\color{codefg},
    rulecolor=\color{codeborder},
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    stepnumber=1,
    stringstyle=\color{codefg},
    tabsize=2,
    title=\lstname
}

% Override any Pandoc default lstset configurations
\AtBeginDocument{
    \lstset{
        backgroundcolor=\color{codebg},
        basicstyle=\footnotesize\ttfamily\color{codefg},
        frame=single,
        framerule=0.5pt,
        framesep=5pt,
        rulecolor=\color{codeborder},
        numbers=left,
        numbersep=5pt,
        numberstyle=\tiny\color{codefg}
    }
}

% Configure hyperref colors consistently
\AtBeginDocument{
% Override pandoc's hidelinks setting with consistent options
\hypersetup{
    colorlinks=true,
    allcolors=red,
    linkcolor=red,
    urlcolor=red,
    citecolor=red,
    filecolor=red,
    menucolor=red,
    linktoc=all
}
}

\title{Equations and Math Supplement}
\author{Daniel Ari Friedman\\ ORCID: 0000-0001-6232-9096\\ Email: daniel@activeinference.institute}
\date{August 15, 2025}

\begin{document}
\maketitle

{
\hypersetup{linkcolor=black}
\setcounter{tocdepth}{3}
\tableofcontents
}
\setstretch{1.0}
\hypertarget{equations-and-math-supplement-appendix}{%
\section{Equations and Math Supplement
(Appendix)}\label{equations-and-math-supplement-appendix}}

\hypertarget{volume-of-a-tetrahedron-lattice}{%
\subsection{Volume of a Tetrahedron
(Lattice)}\label{volume-of-a-tetrahedron-lattice}}

\begin{equation}\label{eq:supp_lattice_det}
V = \tfrac{1}{6}\,\left|\det\,[\,P_1 - P_0,\; P_2 - P_0,\; P_3 - P_0\,]\right|
\end{equation}

Notes.

\begin{itemize}
\tightlist
\item
  \(P_0,\ldots,P_3\) are vertex coordinates; the determinant computes
  the volume of the parallelepiped spanned by edge vectors, with the
  \(1/6\) factor converting to tetra volume.
\end{itemize}

Tom Ace 5×5 tetravolume (IVM units):

\begin{equation}\label{eq:supp_ace5x5}
V_{ivm} = \tfrac{1}{4} \left| \det \begin{pmatrix}
 a_0 & a_1 & a_2 & a_3 & 1 \\
 b_0 & b_1 & b_2 & b_3 & 1 \\
 c_0 & c_1 & c_2 & c_3 & 1 \\
 d_0 & d_1 & d_2 & d_3 & 1 \\
  1 & 1 & 1 & 1 & 0
\end{pmatrix} \right|
\end{equation}

Notes.

\begin{itemize}
\tightlist
\item
  Rows correspond to Quadray 4-tuples of the vertices; the last row
  encodes the affine constraint. Division by 4 returns IVM tetravolume.
\end{itemize}

XYZ determinant volume and S3 conversion:

\begin{equation}\label{eq:supp_xyz_det}
V_{xyz} = \tfrac{1}{6} \left| \det \begin{pmatrix}
 x_a & y_a & z_a & 1 \\
 x_b & y_b & z_b & 1 \\
 x_c & y_c & z_c & 1 \\
  x_d & y_d & z_d & 1
\end{pmatrix} \right|, \qquad V_{ivm} = S3\, V_{xyz},\quad S3=\sqrt{\tfrac{9}{8}}
\end{equation}

Notes.

\begin{itemize}
\tightlist
\item
  Homogeneous determinant in Cartesian coordinates for tetra volume;
  conversion to IVM units uses \(S3=\sqrt{9/8}\) as used throughout.
\end{itemize}

See code:
\href{03_quadray_methods.md\#code:tetra_volume_cayley_menger}{\passthrough{\lstinline!tetra\_volume\_cayley\_menger!}}.
For tetrahedron volume background, see
\href{https://en.wikipedia.org/wiki/Tetrahedron\#Volume}{Tetrahedron --
volume}. Exact integer determinants in code use the
\href{https://en.wikipedia.org/wiki/Bareiss_algorithm}{Bareiss
algorithm}. External validation: these formulas align with
implementations in
\href{https://github.com/4dsolutions/m4w/blob/main/tetravolume.py}{\passthrough{\lstinline!tetravolume.py!}}
from the 4dsolutions ecosystem.

\hypertarget{eq:fim}{%
\subsection{Fisher Information Matrix (FIM)}\label{eq:fim}}

Background:
\href{https://en.wikipedia.org/wiki/Fisher_information}{Fisher
information}.

\begin{equation}\label{eq:supp_fim}
F_{i,j} = \mathbb{E}\left[ \frac{\partial \, \log p(x;\theta)}{\partial \theta_i}\, \frac{\partial \, \log p(x;\theta)}{\partial \theta_j} \right]
\end{equation}

Notes.

\begin{itemize}
\tightlist
\item
  Defines the Fisher information matrix as the expected outer product of
  score functions; see
  \href{https://en.wikipedia.org/wiki/Fisher_information}{Fisher
  information}.
\end{itemize}

Figure: empirical estimate shown in the FIM heatmap figure. See code:
\href{03_quadray_methods.md\#code:fisher_information_matrix}{\passthrough{\lstinline!fisher\_information\_matrix!}}.

See \passthrough{\lstinline!src/information.py!} --- empirical
outer-product estimator
(\passthrough{\lstinline!fisher\_information\_matrix!}).

\hypertarget{eq:natgrad}{%
\subsection{Natural Gradient}\label{eq:natgrad}}

Background:
\href{https://en.wikipedia.org/wiki/Natural_gradient}{Natural gradient}
(Amari).

\begin{equation}\label{eq:supp_natgrad}
\theta \leftarrow \theta - \eta\, F(\theta)^{-1}\, \nabla_{\theta} L(\theta)
\end{equation}

Explanation.

\begin{itemize}
\tightlist
\item
  Natural gradient update: right-precondition the gradient by the
  inverse of the Fisher metric (Amari); see
  \href{https://en.wikipedia.org/wiki/Natural_gradient}{Natural
  gradient}.
\end{itemize}

See code:
\href{03_quadray_methods.md\#code:natural_gradient_step}{\passthrough{\lstinline!natural\_gradient\_step!}}.

See \passthrough{\lstinline!src/information.py!} --- damped
inverse-Fisher step (\passthrough{\lstinline!natural\_gradient\_step!}).

\hypertarget{eq:free_energy}{%
\subsection{Free Energy (Active Inference)}\label{eq:free_energy}}

\begin{equation}\label{eq:supp_free_energy}
\mathcal{F} = -\log P(o\mid s) + \mathrm{KL}\big[ Q(s)\;\|\; P(s) \big]
\end{equation}

Explanation.

\begin{itemize}
\tightlist
\item
  \textbf{Partition}: variational free energy decomposes into expected
  negative log-likelihood and KL between approximate posterior and
  prior; see
  \href{https://en.wikipedia.org/wiki/Free_energy_principle}{Free energy
  principle}.
\end{itemize}

See code:
\href{03_quadray_methods.md\#code:free_energy}{\passthrough{\lstinline!free\_energy!}}.

See \passthrough{\lstinline!src/information.py!} --- discrete-state
variational free energy (\passthrough{\lstinline!free\_energy!}).

\hypertarget{figures}{%
\subsubsection{Figures}\label{figures}}

\begin{figure}
\centering
\includegraphics{../output/figures/natural_gradient_path.png}
\caption{\textbf{Figure 14: Natural gradient trajectory demonstrating
information-geometric optimization}. This trajectory shows natural
gradient descent (Eq. \ref{eq:supp_natgrad}) converging on a quadratic
objective, projected to the \((w_0, w_1)\) parameter plane.
\textbf{Mathematical setup}: Quadratic form matrix
\(A=\begin{bmatrix}3 & 0.5 & 0\\ 0.5 & 2 & 0\\ 0 & 0 & 1\end{bmatrix}\),
step size \(\eta=0.5\), damped Fisher inverse \(F + 10^{-3} I\) for
numerical stability. \textbf{Trajectory characteristics}: The curved
path demonstrates curvature-adaptive steps---larger strides in
low-curvature directions, smaller steps in high-curvature
directions---contrasting with uniform Euclidean gradient steps.
\textbf{Information geometry}: Each step follows approximate geodesics
on the parameter manifold equipped with the Fisher metric, achieving
more efficient convergence than standard gradient descent on
ill-conditioned problems. \textbf{Data artifacts}: Complete 3D
trajectory data saved as
\passthrough{\lstinline!natural\_gradient\_path.csv!} and
\passthrough{\lstinline!natural\_gradient\_path.npz!} for
reproducibility and further analysis.}
\end{figure}

\begin{figure}
\centering
\includegraphics{../output/figures/free_energy_curve.png}
\caption{\textbf{Figure 15: Variational free energy functional for
discrete binary states (Eq. \ref{eq:supp_free_energy})}. This curve
illustrates the free energy landscape
\(\mathcal{F} = -\log P(o|s) + \text{KL}[Q(s)||P(s)]\) for a 2-state
system as a function of variational posterior probability
\(q(\text{state}=0) \in [0.001, 0.999]\). \textbf{Model specification}:
True likelihood \(\log P(o|s) = \log[0.7, 0.3]\), uniform prior
\(P(s) = [0.5, 0.5]\), variational posterior \(Q(s) = [q, 1-q]\).
\textbf{Free energy interpretation}: The convex curve shows the
trade-off between likelihood accuracy (observation explanation) and
complexity penalty (KL divergence from prior). \textbf{Optimization}:
The global minimum represents the optimal variational approximation
where beliefs match the true posterior distribution. \textbf{Active
Inference}: This functional drives belief updating in the four-fold
partition framework, with the minimum achieved through gradient-based
inference or discrete lattice descent methods. The convex structure
ensures reliable convergence for variational optimization in discrete
state spaces.}
\end{figure}

\begin{figure}
\centering
\includegraphics{../output/figures/discrete_path_final.png}
\caption{\textbf{Figure 16: Discrete IVM descent optimization path
(final converged state)}. This static frame shows the final position of
a discrete variational descent algorithm operating on the integer
Quadray lattice. \textbf{Algorithm}:
\passthrough{\lstinline!discrete\_ivm\_descent!} performs greedy
optimization using the 12 canonical IVM neighbor moves (permutations of
\{2,1,1,0\}), ensuring all iterates remain on integer lattice points
with proper Quadray normalization. \textbf{Objective}: Simple quadratic
function \(f(q) = (x-0.5)^2 + (y+0.2)^2 + (z-0.1)^2\) where \((x,y,z)\)
are the embedded Euclidean coordinates of Quadray \(q\).
\textbf{Convergence}: The final point represents the best lattice
approximation to the continuous optimum, demonstrating discrete
convergence within the integer-constrained feasible region.
\textbf{Fuller.4D significance}: This method exemplifies optimization
directly on the Quadray integer lattice without continuous relaxation,
maintaining exact arithmetic and leveraging the discrete ``energy
level'' structure of integer tetravolumes. \textbf{Animation}: The
complete optimization trajectory is available as
\passthrough{\lstinline!discrete\_path.mp4!} with corresponding
trajectory data in \passthrough{\lstinline!discrete\_path.csv!} and
\passthrough{\lstinline!discrete\_path.npz!}.}
\end{figure}

\begin{figure}
\centering
\includegraphics{../output/figures/bridging_vs_native.png}
\caption{\textbf{Figure 17: Bridging (CM+S3) vs Native (Ace) IVM
tetravolumes across canonical integer-quadray examples}. Bars compare
\(V_{ivm}\) computed via Cayley--Menger on XYZ edge lengths with
\(S3=\sqrt{9/8}\) conversion (bridging) against Tom Ace's native 5×5
determinant (IVM). The overlaid bars coincide to numerical precision,
illustrating the equivalence of length-based and Quadray-native
formulations under synergetics units. Source CSV:
\passthrough{\lstinline!bridging\_vs\_native.csv!}.}
\end{figure}

\hypertarget{quadray-normalization-fuller.4d}{%
\subsection{Quadray Normalization
(Fuller.4D)}\label{quadray-normalization-fuller.4d}}

Given \(q=(a,b,c,d)\), choose \(k=\min(a,b,c,d)\) and set
\(q' = q - (k,k,k,k)\) to enforce at least one zero with non-negative
entries.

\hypertarget{distance-embedding-sketch-coxeter.4d-slice}{%
\subsection{Distance (Embedding Sketch; Coxeter.4D
slice)}\label{distance-embedding-sketch-coxeter.4d-slice}}

Choose linear map \(M\) from quadray to \(\mathbb{R}^3\) (or
\(\mathbb{R}^4\)) consistent with tetrahedral axes; then
\(d(q_1,q_2) = \lVert M(q_1) - M(q_2) \rVert_2\).

\hypertarget{minkowski-line-element-einstein.4d-analogy}{%
\subsection{Minkowski Line Element (Einstein.4D
analogy)}\label{minkowski-line-element-einstein.4d-analogy}}

\begin{equation}\label{eq:supp_minkowski}
ds^2 = -c^2\,dt^2 + dx^2 + dy^2 + dz^2
\end{equation}

Background:
\href{https://en.wikipedia.org/wiki/Minkowski_space}{Minkowski space}.

\hypertarget{high-precision-arithmetic-note}{%
\subsection{High-Precision Arithmetic
Note}\label{high-precision-arithmetic-note}}

When evaluating determinants, FIMs, or geodesic distances for sensitive
problems, use quad precision (binary128) via GCC's
\passthrough{\lstinline!libquadmath!}
(\passthrough{\lstinline!\_\_float128!}, functions like
\passthrough{\lstinline!expq!}, \passthrough{\lstinline!sqrtq!}, and
\passthrough{\lstinline!quadmath\_snprintf!}). See
\href{https://gcc.gnu.org/onlinedocs/libquadmath/index.html}{GCC
libquadmath}. Where possible, it is useful to use symbolic math
libraries like SymPy to compute exact values.

\hypertarget{reproducibility-artifacts-and-external-validation}{%
\subsubsection{Reproducibility artifacts and external
validation}\label{reproducibility-artifacts-and-external-validation}}

\begin{itemize}
\tightlist
\item
  \textbf{This manuscript's artifacts}: Raw data in
  \passthrough{\lstinline!quadmath/output/!} for reproducibility and
  downstream analysis:

  \begin{itemize}
  \item
    \passthrough{\lstinline!fisher\_information\_matrix.csv!} /
    \passthrough{\lstinline!.npz!}: empirical Fisher matrix and inputs
  \item
    \passthrough{\lstinline!fisher\_information\_eigenvalues.csv!} /
    \passthrough{\lstinline!fisher\_information\_eigensystem.npz!}:
    eigenspectrum and eigenvectors
  \item
    \passthrough{\lstinline!natural\_gradient\_path.png!} with
    \passthrough{\lstinline!natural\_gradient\_path.csv!} /
    \passthrough{\lstinline!.npz!}: projected trajectory and raw
    coordinates
  \item
    \passthrough{\lstinline!bridging\_vs\_native.csv!}: Ace 5×5 vs CM+S3
    tetravolume comparisons
  \item
    \passthrough{\lstinline!ivm\_neighbors\_data.csv!} /
    \passthrough{\lstinline!ivm\_neighbors\_edges\_data.npz!}: neighbor
    coordinates (Quadray and XYZ)
  \item
    \passthrough{\lstinline!polyhedra\_quadray\_constructions.png!}:
    synergetics volume relationships schematic
  \end{itemize}
\item
  \textbf{External validation resources}: The
  \href{https://github.com/4dsolutions}{4dsolutions ecosystem} provides
  extensive cross-validation:

  \begin{itemize}
  \tightlist
  \item
    \href{https://github.com/4dsolutions/School_of_Tomorrow/blob/master/Qvolume.ipynb}{\passthrough{\lstinline!Qvolume.ipynb!}}:
    Independent Tom Ace 5×5 implementations with random-walk
    demonstrations
  \item
    \href{https://github.com/4dsolutions/School_of_Tomorrow/blob/master/VolumeTalk.ipynb}{\passthrough{\lstinline!VolumeTalk.ipynb!}}:
    Comparative tetravolume algorithm analysis
  \item
    Cross-language implementations in
    \href{https://github.com/4dsolutions/rusty_rays}{Rust} and
    \href{https://github.com/4dsolutions/synmods}{Clojure} for
    algorithmic verification
  \end{itemize}
\end{itemize}

\hypertarget{namespaces-summary-notation}{%
\subsection{Namespaces summary
(notation)}\label{namespaces-summary-notation}}

\begin{itemize}
\tightlist
\item
  Coxeter.4D: Euclidean E⁴; regular polytopes; not spacetime
  (cf.~Coxeter, Regular Polytopes, Dover ed., p.~119). Connections to
  higher-dimensional lattices and packings as in Conway \& Sloane.
\item
  Einstein.4D: Minkowski spacetime; indefinite metric; used here only as
  a metric analogy when discussing geodesics and information geometry.
\item
  Fuller.4D: Quadrays/IVM; tetrahedral lattice with integer tetravolume;
  unit regular tetrahedron has volume 1; synergetics scale relations
  (e.g., S3).
\end{itemize}

\end{document}
