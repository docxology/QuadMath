% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames*,x11names*}{xcolor}
%
\documentclass[
  10pt,
]{article}
\usepackage{lmodern}
\usepackage{setspace}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
  \setmainfont[]{DejaVu Serif}
  \setmonofont[]{DejaVu Sans Mono}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  colorlinks=true,
  linkcolor=red,
  filecolor=red,
  citecolor=red,
  urlcolor=red,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage[margin=1cm,top=1cm,bottom=1cm,left=1cm,right=1cm,includeheadfoot]{geometry}
\usepackage{listings}
\newcommand{\passthrough}[1]{#1}
\lstset{defaultdialect=[5.3]Lua}
\lstset{defaultdialect=[x86masm]Assembler}
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{3}
% Enable graphics inclusion and ensure figure numbering works
\usepackage{graphicx}
\renewcommand{\figurename}{Figure}

% Configure fonts for Unicode support with fallbacks
\usepackage{newunicodechar}
\newunicodechar{⁴}{\textsuperscript{4}}
\newunicodechar{₄}{\textsubscript{4}}

% Enhanced code block styling for better contrast and readability
\usepackage{fancyvrb}
\usepackage{xcolor}
\usepackage{listings}

% Define custom colors for code blocks
\definecolor{codebg}{RGB}{245, 245, 245}      % Light gray background
\definecolor{codeborder}{RGB}{200, 200, 200}  % Medium gray border
\definecolor{codefg}{RGB}{50, 50, 50}         % Dark gray text

% Configure Verbatim environment for inline code
\DefineVerbatimEnvironment{Verbatim}{Verbatim}{%
    fontsize=\small,
    frame=single,
    framerule=0.5pt,
    framesep=3pt,
    rulecolor=\color{codeborder},
    bgcolor=\color{codebg},
    fgcolor=\color{codefg}
}

% Configure code block styling
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{%
    fontsize=\footnotesize,
    frame=single,
    framerule=0.5pt,
    framesep=5pt,
    rulecolor=\color{codeborder},
    bgcolor=\color{codebg},
    fgcolor=\color{codefg}
}

% Style inline code with \texttt
\renewcommand{\texttt}[1]{%
    \colorbox{codebg}{\color{codefg}\ttfamily #1}%
}

% Configure listings package for code blocks
\lstset{
    backgroundcolor=\color{codebg},
    basicstyle=\footnotesize\ttfamily\color{codefg},
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    commentstyle=\color{codefg},
    deletekeywords={...},
    escapeinside={\%*}{*)},
    extendedchars=true,
    frame=single,
    framerule=0.5pt,
    framesep=5pt,
    keepspaces=true,
    keywordstyle=\color{codefg},
    language=Python,
    morekeywords={*,...},
    numbers=left,
    numbersep=5pt,
    numberstyle=\tiny\color{codefg},
    rulecolor=\color{codeborder},
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    stepnumber=1,
    stringstyle=\color{codefg},
    tabsize=2,
    title=\lstname
}

% Override any Pandoc default lstset configurations
\AtBeginDocument{
    \lstset{
        backgroundcolor=\color{codebg},
        basicstyle=\footnotesize\ttfamily\color{codefg},
        frame=single,
        framerule=0.5pt,
        framesep=5pt,
        rulecolor=\color{codeborder},
        numbers=left,
        numbersep=5pt,
        numberstyle=\tiny\color{codefg}
    }
}

% Configure hyperref colors consistently
\AtBeginDocument{
% Override pandoc's hidelinks setting with consistent options
\hypersetup{
    colorlinks=true,
    allcolors=red,
    linkcolor=red,
    urlcolor=red,
    citecolor=red,
    filecolor=red,
    menucolor=red,
    linktoc=all
}
}

% Simple page break support for document structure

\title{Equations and Math Supplement}
\author{Daniel Ari Friedman\\ ORCID: 0000-0001-6232-9096\\ Email: daniel@activeinference.institute}
\date{August 16, 2025}

\begin{document}
\maketitle

{
\hypersetup{linkcolor=black}
\setcounter{tocdepth}{3}
\tableofcontents
}
\setstretch{1.0}
\hypertarget{equations-and-math-supplement-appendix}{%
\section{Equations and Math Supplement
(Appendix)}\label{equations-and-math-supplement-appendix}}

\hypertarget{volume-of-a-tetrahedron-lattice}{%
\subsection{Volume of a Tetrahedron
(Lattice)}\label{volume-of-a-tetrahedron-lattice}}

\begin{equation}\label{eq:lattice_det}
V = \tfrac{1}{6}\,\left|\det\,[\,P_1 - P_0,\; P_2 - P_0,\; P_3 - P_0\,]\right|
\end{equation}

Notes.

\begin{itemize}
\tightlist
\item
  \(P_0,\ldots,P_3\) are vertex coordinates; the determinant computes
  the volume of the parallelepiped spanned by edge vectors, with the
  \(1/6\) factor converting to tetra volume.
\end{itemize}

Tom Ace 5×5 tetravolume (IVM units):

\begin{equation}\label{eq:ace5x5}
V_{ivm} = \tfrac{1}{4} \left| \det \begin{pmatrix}
 a_0 & a_1 & a_2 & a_3 & 1 \\
 b_0 & b_1 & b_2 & b_3 & 1 \\
 c_0 & c_1 & c_2 & c_3 & 1 \\
 d_0 & d_1 & d_2 & d_3 & 1 \\
  1 & 1 & 1 & 1 & 0
\end{pmatrix} \right|
\end{equation}

Notes.

\begin{itemize}
\tightlist
\item
  Rows correspond to Quadray 4-tuples of the vertices; the last row
  encodes the affine constraint. Division by 4 returns IVM tetravolume.
\end{itemize}

\hypertarget{expanded-ace-55-matrix}{%
\subsection{Expanded Ace 5×5 Matrix}\label{expanded-ace-55-matrix}}

The expanded form of the Ace 5×5 matrix with explicit Quadray
coordinates:

\begin{equation}\label{eq:ace5x5_expanded}
M(q_0,q_1,q_2,q_3) = \begin{bmatrix}
q_{01} & q_{02} & q_{03} & q_{04} & 1 \\
q_{11} & q_{12} & q_{13} & q_{14} & 1 \\
q_{21} & q_{22} & q_{23} & q_{24} & 1 \\
q_{31} & q_{32} & q_{33} & q_{34} & 1 \\
1 & 1 & 1 & 1 & 0
\end{bmatrix}, \qquad V_{ivm} = \tfrac{1}{4}\,\big|\det M(q_0,q_1,q_2,q_3)\big|
\end{equation}

Notes.

\begin{itemize}
\tightlist
\item
  \textbf{Matrix structure}: Each row represents a vertex with its
  Quadray coordinates plus affine coordinate 1.
\item
  \textbf{Last row}: Enforces projective normalization constraint.
\item
  \textbf{Volume computation}: Determinant divided by 4 gives IVM
  tetravolume.
\end{itemize}

XYZ determinant volume and S3 conversion:

\begin{equation}\label{eq:xyz_det}
V_{xyz} = \tfrac{1}{6} \left| \det \begin{pmatrix}
 x_a & y_a & z_a & 1 \\
 x_b & y_b & z_b & 1 \\
 x_c & y_c & z_c & 1 \\
  x_d & y_d & z_d & 1
\end{pmatrix} \right|, \qquad V_{ivm} = S3\, V_{xyz},\quad S3=\sqrt{\tfrac{9}{8}}
\end{equation}

Notes.

\begin{itemize}
\tightlist
\item
  Homogeneous determinant in Cartesian coordinates for tetra volume;
  conversion to IVM units uses \(S3=\sqrt{9/8}\) as used throughout.
\end{itemize}

\hypertarget{cayley-menger-determinant-coxeter.4d}{%
\subsection{Cayley-Menger Determinant
(Coxeter.4D)}\label{cayley-menger-determinant-coxeter.4d}}

For tetrahedron volume from edge lengths (Coxeter.4D approach):

\begin{equation}\label{eq:cayley_menger}
288\,V^2 = \det\begin{pmatrix}
  0 & 1 & 1 & 1 & 1 \\
  1 & 0 & d_{01}^2 & d_{02}^2 & d_{03}^2 \\
  1 & d_{10}^2 & 0 & d_{12}^2 & d_{13}^2 \\
  1 & d_{20}^2 & d_{21}^2 & 0 & d_{23}^2 \\
  1 & d_{30}^2 & d_{31}^2 & d_{32}^2 & 0
\end{pmatrix}
\end{equation}

Notes.

\begin{itemize}
\tightlist
\item
  \textbf{Pairwise distances}: \(d_{ij}\) are Euclidean distances
  between vertices \(P_i\) and \(P_j\).
\item
  \textbf{Length-only formulation}: Cayley--Menger provides a
  length-only formula for simplex volumes, here specialized to
  tetrahedra.
\item
  \textbf{Conversion to IVM}: Use \(V_{ivm} = S3 \cdot V_{xyz}\) with
  \(S3=\sqrt{9/8}\) to convert to IVM units.
\end{itemize}

\hypertarget{piero-della-francesca-formula-pdf}{%
\subsection{Piero della Francesca Formula
(PDF)}\label{piero-della-francesca-formula-pdf}}

For tetrahedron volume from edge lengths meeting at a vertex:

\begin{equation}\label{eq:pdf}
144\,V_{xyz}^2 = 4 a^2 b^2 c^2 - a^2\,(b^2 + c^2 - f^2)^2 - b^2\,(c^2 + a^2 - e^2)^2 - c^2\,(a^2 + b^2 - d^2)^2 + (b^2 + c^2 - f^2)(c^2 + a^2 - e^2)(a^2 + b^2 - d^2)
\end{equation}

Notes.

\begin{itemize}
\tightlist
\item
  \textbf{Edge lengths}: \(a,b,c\) are edges meeting at a vertex,
  \(d,e,f\) are opposite edges.
\item
  \textbf{Conversion to IVM}: Use \(V_{ivm} = S3 \cdot V_{xyz}\) with
  \(S3=\sqrt{9/8}\).
\end{itemize}

\hypertarget{gerald-de-jong-formula-gdj}{%
\subsection{Gerald de Jong Formula
(GdJ)}\label{gerald-de-jong-formula-gdj}}

Native Quadray formula for tetrahedron volume:

\begin{equation}\label{eq:gdj}
V_{ivm} = \frac{1}{4}\,\left|\det \begin{pmatrix}
a_1-a_0 & a_2-a_0 & a_3-a_0 \\
b_1-b_0 & b_2-b_0 & b_3-b_0 \\
c_1-c_0 & c_2-c_0 & c_3-c_0 \\
\end{pmatrix}\right|
\end{equation}

Notes.

\begin{itemize}
\tightlist
\item
  \textbf{Quadray differences}: Each column represents edge vectors
  \(P_1-P_0\), \(P_2-P_0\), \(P_3-P_0\) in Quadray coordinates.
\item
  \textbf{Native IVM}: Returns tetravolume directly in IVM units without
  conversion.
\item
  \textbf{Integer arithmetic}: Exact for integer Quadray coordinates.
\end{itemize}

See code:
\href{03_quadray_methods.md\#code:tetra_volume_cayley_menger}{\passthrough{\lstinline!tetra\_volume\_cayley\_menger!}}.
For tetrahedron volume background, see
\href{https://en.wikipedia.org/wiki/Tetrahedron\#Volume}{Tetrahedron --
volume}. Exact integer determinants in code use the
\href{https://en.wikipedia.org/wiki/Bareiss_algorithm}{Bareiss
algorithm}. External validation: these formulas align with
implementations in the 4dsolutions ecosystem. See the
\href{07_resources.md}{Resources} section for comprehensive details.

\hypertarget{eq:fim}{%
\subsection{Fisher Information Matrix (FIM)}\label{eq:fim}}

Background:
\href{https://en.wikipedia.org/wiki/Fisher_information}{Fisher
information}.

\begin{equation}\label{eq:fim}
F_{i,j} = \mathbb{E}\left[ \frac{\partial \, \log p(x;\theta)}{\partial \theta_i}\, \frac{\partial \, \log p(x;\theta)}{\partial \theta_j} \right]
\end{equation}

Notes.

\begin{itemize}
\tightlist
\item
  Defines the Fisher information matrix as the expected outer product of
  score functions; see
  \href{https://en.wikipedia.org/wiki/Fisher_information}{Fisher
  information}.
\end{itemize}

Figure: empirical estimate shown in the FIM heatmap figure. See code:
\href{03_quadray_methods.md\#code:fisher_information_matrix}{\passthrough{\lstinline!fisher\_information\_matrix!}}.

See \passthrough{\lstinline!src/information.py!} --- empirical
outer-product estimator
(\passthrough{\lstinline!fisher\_information\_matrix!}).

\hypertarget{empirical-fisher-information-matrix}{%
\subsection{Empirical Fisher Information
Matrix}\label{empirical-fisher-information-matrix}}

For empirical estimation from data, the Fisher Information Matrix is
computed as:

\begin{equation}\label{eq:fim_empirical}
F_{i,j} = \frac{1}{N} \sum_{n=1}^{N} \frac{\partial \, \log p(x_n;\theta)}{\partial \theta_i}\, \frac{\partial \, \log p(x_n;\theta)}{\partial \theta_j}
\end{equation}

Notes.

\begin{itemize}
\tightlist
\item
  Empirical estimate of the FIM from \(N\) data samples; converges to
  the theoretical FIM as \(N \to \infty\).
\item
  Used in natural gradient descent and information geometry
  applications.
\end{itemize}

\hypertarget{eq:natgrad}{%
\subsection{Natural Gradient}\label{eq:natgrad}}

Background:
\href{https://en.wikipedia.org/wiki/Natural_gradient}{Natural gradient}
(Amari).

\begin{equation}\label{eq:natural_gradient}
\theta \leftarrow \theta - \eta\, F(\theta)^{-1}\, \nabla_{\theta} L(\theta)
\end{equation}

Explanation.

\begin{itemize}
\tightlist
\item
  Natural gradient update: right-precondition the gradient by the
  inverse of the Fisher metric (Amari); see
  \href{https://en.wikipedia.org/wiki/Natural_gradient}{Natural
  gradient}.
\end{itemize}

See code:
\href{03_quadray_methods.md\#code:natural_gradient_step}{\passthrough{\lstinline!natural\_gradient\_step!}}.

See \passthrough{\lstinline!src/information.py!} --- damped
inverse-Fisher step (\passthrough{\lstinline!natural\_gradient\_step!}).

\hypertarget{eq:free_energy}{%
\subsection{Free Energy (Active Inference)}\label{eq:free_energy}}

\begin{equation}\label{eq:free_energy}
\mathcal{F} = -\log P(o\mid s) + \mathrm{KL}\big[ Q(s)\;\|\; P(s) \big]
\end{equation}

Explanation.

\begin{itemize}
\tightlist
\item
  \textbf{Partition}: variational free energy decomposes into expected
  negative log-likelihood and KL between approximate posterior and
  prior; see
  \href{https://en.wikipedia.org/wiki/Free_energy_principle}{Free energy
  principle}.
\end{itemize}

See code:
\href{03_quadray_methods.md\#code:free_energy}{\passthrough{\lstinline!free\_energy!}}.

See \passthrough{\lstinline!src/information.py!} --- discrete-state
variational free energy (\passthrough{\lstinline!free\_energy!}).

\textbf{Note}: The main figures demonstrating natural gradient
trajectories and free energy landscapes are shown in
\href{04_optimization_in_4d.md}{Section 4: Optimization in 4D}. The
appendix focuses on unique figures specific to mathematical formulations
and validation.

\hypertarget{quadray-normalization-fuller.4d}{%
\subsection{Quadray Normalization
(Fuller.4D)}\label{quadray-normalization-fuller.4d}}

Given \(q=(a,b,c,d)\), choose \(k=\min(a,b,c,d)\) and set
\(q' = q - (k,k,k,k)\) to enforce at least one zero with non-negative
entries.

\hypertarget{distance-embedding-sketch-coxeter.4d-slice}{%
\subsection{Distance (Embedding Sketch; Coxeter.4D
slice)}\label{distance-embedding-sketch-coxeter.4d-slice}}

Choose linear map \(M\) from quadray to \(\mathbb{R}^3\) (or
\(\mathbb{R}^4\)) consistent with tetrahedral axes; then
\(d(q_1,q_2) = \lVert M(q_1) - M(q_2) \rVert_2\).

\hypertarget{minkowski-line-element-einstein.4d-analogy}{%
\subsection{Minkowski Line Element (Einstein.4D
analogy)}\label{minkowski-line-element-einstein.4d-analogy}}

\begin{equation}\label{eq:minkowski_line_element}
ds^2 = -c^2\,dt^2 + dx^2 + dy^2 + dz^2
\end{equation}

Background:
\href{https://en.wikipedia.org/wiki/Minkowski_space}{Minkowski space}.

\hypertarget{high-precision-arithmetic-note}{%
\subsection{High-Precision Arithmetic
Note}\label{high-precision-arithmetic-note}}

When evaluating determinants, FIMs, or geodesic distances for sensitive
problems, use quad precision (binary128) via GCC's
\passthrough{\lstinline!libquadmath!}
(\passthrough{\lstinline!\_\_float128!}, functions like
\passthrough{\lstinline!expq!}, \passthrough{\lstinline!sqrtq!}, and
\passthrough{\lstinline!quadmath\_snprintf!}). See
\href{https://gcc.gnu.org/onlinedocs/libquadmath/index.html}{GCC
libquadmath}. Where possible, it is useful to use symbolic math
libraries like SymPy to compute exact values.

\hypertarget{reproducibility-artifacts-and-external-validation}{%
\subsubsection{Reproducibility artifacts and external
validation}\label{reproducibility-artifacts-and-external-validation}}

\begin{itemize}
\tightlist
\item
  \textbf{This manuscript's artifacts}: Raw data in
  \passthrough{\lstinline!quadmath/output/!} for reproducibility and
  downstream analysis:

  \begin{itemize}
  \item
    \passthrough{\lstinline!fisher\_information\_matrix.csv!} /
    \passthrough{\lstinline!.npz!}: empirical Fisher matrix and inputs
  \item
    \passthrough{\lstinline!fisher\_information\_eigenvalues.csv!} /
    \passthrough{\lstinline!fisher\_information\_eigensystem.npz!}:
    eigenspectrum and eigenvectors
  \item
    \passthrough{\lstinline!natural\_gradient\_path.png!} with
    \passthrough{\lstinline!natural\_gradient\_path.csv!} /
    \passthrough{\lstinline!.npz!}: projected trajectory and raw
    coordinates
  \item
    \passthrough{\lstinline!ivm\_neighbors\_data.csv!} /
    \passthrough{\lstinline!ivm\_neighbors\_edges\_data.npz!}: neighbor
    coordinates (Quadray and XYZ)
  \item
    \passthrough{\lstinline!polyhedra\_quadray\_constructions.png!}:
    synergetics volume relationships schematic
  \end{itemize}
\item
  \textbf{External validation resources}: The
  \href{https://github.com/4dsolutions}{4dsolutions ecosystem} provides
  extensive cross-validation. See the \href{07_resources.md}{Resources}
  section for comprehensive details on computational implementations and
  validation.
\end{itemize}

\hypertarget{namespaces-summary-notation}{%
\subsection{Namespaces summary
(notation)}\label{namespaces-summary-notation}}

\begin{itemize}
\tightlist
\item
  Coxeter.4D: Euclidean E⁴; regular polytopes; not spacetime
  (cf.~Coxeter, Regular Polytopes, Dover ed., p.~119). Connections to
  higher-dimensional lattices and packings as in Conway \& Sloane.
\item
  Einstein.4D: Minkowski spacetime; indefinite metric; used here only as
  a metric analogy when discussing geodesics and information geometry.
\item
  Fuller.4D: Quadrays/IVM; tetrahedral lattice with integer tetravolume;
  unit regular tetrahedron has volume 1; synergetics scale relations
  (e.g., S3).
\end{itemize}

\end{document}
