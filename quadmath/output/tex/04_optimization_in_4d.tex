% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames*,x11names*}{xcolor}
%
\documentclass[
  10pt,
]{article}
\usepackage{lmodern}
\usepackage{setspace}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
  \setmainfont[]{DejaVu Serif}
  \setmonofont[]{DejaVu Sans Mono}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  colorlinks=true,
  linkcolor=red,
  filecolor=red,
  citecolor=red,
  urlcolor=red,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage[margin=1cm,top=1cm,bottom=1cm,left=1cm,right=1cm,includeheadfoot]{geometry}
\usepackage{listings}
\newcommand{\passthrough}[1]{#1}
\lstset{defaultdialect=[5.3]Lua}
\lstset{defaultdialect=[x86masm]Assembler}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{3}
% Enable graphics inclusion and ensure figure numbering works
\usepackage{graphicx}
\renewcommand{\figurename}{Figure}

% Configure fonts for Unicode support with fallbacks
\usepackage{newunicodechar}
\newunicodechar{⁴}{\textsuperscript{4}}
\newunicodechar{₄}{\textsubscript{4}}

% Enhanced code block styling for better contrast and readability
\usepackage{fancyvrb}
\usepackage{xcolor}
\usepackage{listings}

% Define custom colors for code blocks
\definecolor{codebg}{RGB}{245, 245, 245}      % Light gray background
\definecolor{codeborder}{RGB}{200, 200, 200}  % Medium gray border
\definecolor{codefg}{RGB}{50, 50, 50}         % Dark gray text

% Configure Verbatim environment for inline code
\DefineVerbatimEnvironment{Verbatim}{Verbatim}{%
    fontsize=\small,
    frame=single,
    framerule=0.5pt,
    framesep=3pt,
    rulecolor=\color{codeborder},
    bgcolor=\color{codebg},
    fgcolor=\color{codefg}
}

% Configure code block styling
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{%
    fontsize=\footnotesize,
    frame=single,
    framerule=0.5pt,
    framesep=5pt,
    rulecolor=\color{codeborder},
    bgcolor=\color{codebg},
    fgcolor=\color{codefg}
}

% Style inline code with \texttt
\renewcommand{\texttt}[1]{%
    \colorbox{codebg}{\color{codefg}\ttfamily #1}%
}

% Configure listings package for code blocks
\lstset{
    backgroundcolor=\color{codebg},
    basicstyle=\footnotesize\ttfamily\color{codefg},
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    commentstyle=\color{codefg},
    deletekeywords={...},
    escapeinside={\%*}{*)},
    extendedchars=true,
    frame=single,
    framerule=0.5pt,
    framesep=5pt,
    keepspaces=true,
    keywordstyle=\color{codefg},
    language=Python,
    morekeywords={*,...},
    numbers=left,
    numbersep=5pt,
    numberstyle=\tiny\color{codefg},
    rulecolor=\color{codeborder},
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    stepnumber=1,
    stringstyle=\color{codefg},
    tabsize=2,
    title=\lstname
}

% Override any Pandoc default lstset configurations
\AtBeginDocument{
    \lstset{
        backgroundcolor=\color{codebg},
        basicstyle=\footnotesize\ttfamily\color{codefg},
        frame=single,
        framerule=0.5pt,
        framesep=5pt,
        rulecolor=\color{codeborder},
        numbers=left,
        numbersep=5pt,
        numberstyle=\tiny\color{codefg}
    }
}

% Configure hyperref colors consistently
\AtBeginDocument{
% Override pandoc's hidelinks setting with consistent options
\hypersetup{
    colorlinks=true,
    allcolors=red,
    linkcolor=red,
    urlcolor=red,
    citecolor=red,
    filecolor=red,
    menucolor=red,
    linktoc=all
}
}

\title{Optimization in 4D}
\author{Daniel Ari Friedman\\ ORCID: 0000-0001-6232-9096\\ Email: daniel@activeinference.institute}
\date{August 15, 2025}

\begin{document}
\maketitle

{
\hypersetup{linkcolor=black}
\setcounter{tocdepth}{3}
\tableofcontents
}
\setstretch{1.0}
\hypertarget{optimization-in-4d}{%
\section{Optimization in 4D}\label{optimization-in-4d}}

\hypertarget{overview}{%
\subsection{Overview}\label{overview}}

This section describes optimization methods adapted to the integer
Quadray lattice, emphasizing discrete convergence and
information-geometric approaches. The methods leverage the IVM's natural
quantization and extend to higher-dimensional spaces via Coxeter.4D
embeddings.

\hypertarget{neldermead-on-integer-lattice}{%
\subsection{Nelder--Mead on Integer
Lattice}\label{neldermead-on-integer-lattice}}

\begin{itemize}
\tightlist
\item
  \textbf{Adaptation}: standard Nelder--Mead simplex operations with
  projection to integer Quadray coordinates.
\item
  \textbf{Projection}: after each reflection/expansion/contraction, snap
  to nearest integer lattice point via projective normalization.
\item
  \textbf{Volume tracking}: monitor integer tetravolume as convergence
  diagnostic; discrete steps create stable plateaus.
\end{itemize}

\hypertarget{parameters}{%
\subsubsection{Parameters}\label{parameters}}

\begin{itemize}
\tightlist
\item
  \textbf{Reflection} \(\alpha \approx 1\)
\item
  \textbf{Expansion} \(\gamma \approx 2\)
\item
  \textbf{Contraction} \(\rho \approx 0.5\)
\item
  \textbf{Shrink} \(\sigma \approx 0.5\)
\end{itemize}

References: original Nelder--Mead method and common parameterizations in
optimization texts and survey articles; see overview:
\href{https://en.wikipedia.org/wiki/Nelder\%E2\%80\%93Mead_method}{Nelder--Mead
method}.

\hypertarget{volume-level-dynamics}{%
\subsection{Volume-Level Dynamics}\label{volume-level-dynamics}}

\begin{itemize}
\tightlist
\item
  Simplex volume decreases in discrete integer steps, creating stable
  plateaus (``energy levels'').
\item
  Termination: when volume stabilizes at a minimal level and function
  spread is below tolerance.
\item
  Monitoring: track integer simplex volume and the objective spread at
  each iteration for convergence diagnostics.
\end{itemize}

\hypertarget{pseudocode-sketch}{%
\subsection{Pseudocode (Sketch)}\label{pseudocode-sketch}}

\begin{lstlisting}
while not converged:
  order vertices by objective
  centroid of best three
  propose reflected (then possibly expanded/contracted) point
  project to integer quadray; renormalize with (k,k,k,k)
  accept per standard tests; else shrink toward best
  update integer volume and function spread trackers
\end{lstlisting}

\hypertarget{figures}{%
\subsubsection{Figures}\label{figures}}

\begin{figure}
\centering
\includegraphics{../output/figures/simplex_trace.png}
\caption{\textbf{Discrete Nelder--Mead optimization trajectory on the
integer Quadray lattice}. This time-series plot tracks key diagnostic
quantities across 12 optimization iterations for a simple quadratic
objective function defined on the integer Quadray lattice.
\textbf{X-axis}: Optimization iteration (0 through 12). \textbf{Y-axis}:
Key diagnostic values including objective function value (blue line),
simplex volume (orange line), and maximum vertex spread (green line).
\textbf{Key observations}: The objective function decreases
monotonically from iteration 0 to 12, showing convergence. The simplex
volume (orange) exhibits discrete plateaus characteristic of
integer-lattice optimization, where the Nelder--Mead algorithm can only
move to integer coordinate positions. The maximum vertex spread (green)
decreases as the simplex contracts around the optimum, indicating that
the four vertices of the optimization tetrahedron are converging to a
tight cluster. \textbf{Discrete lattice behavior}: Unlike continuous
optimization where the simplex can shrink to arbitrary precision, the
integer Quadray lattice constrains the simplex to discrete volume
levels, creating the characteristic step-like volume profile. This
discrete behavior is captured in the MP4 animation
(\passthrough{\lstinline!simplex\_animation.mp4!}) and the diagnostic
traces in the following figure. The final simplex volume is minimal on
the integer lattice, representing a stable ``energy level'' where
further discrete moves do not improve the objective function.}
\end{figure}

\begin{figure}
\centering
\includegraphics{../output/figures/volumes_scale_plot.png}
\caption{\textbf{Tetrahedron volume scaling relationships: Euclidean vs
IVM unit conventions}. This plot demonstrates the mathematical
relationship between edge length scaling and tetravolume under both
Euclidean (XYZ) and IVM (synergetics) unit conventions. \textbf{X-axis}:
Edge length scaling factor (0.5 to 2.0). \textbf{Y-axis}: Tetrahedron
volume in respective units. \textbf{Blue line (Euclidean)}: Volume
scales as the cube of edge length, following the standard
\(V = \frac{\sqrt{2}}{12} \cdot L^3\) relationship for regular
tetrahedra. \textbf{Orange line (IVM)}: Volume scales as the cube of
edge length but in IVM tetra-units, following
\(V_{ivm} = \frac{1}{8} \cdot L^3\) where the regular tetrahedron with
unit edge has volume 1/8. \textbf{Key insight}: The ratio between these
two scaling laws is the synergetics factor
\(S3 = \sqrt{9/8} \approx 1.06066\), which converts between Euclidean
and IVM volume conventions. \textbf{Discrete optimization context}: When
working on the integer Quadray lattice, this scaling relationship helps
diagnose whether volume changes are due to geometric scaling or discrete
lattice effects. The plot shows that both conventions preserve the cubic
scaling relationship, but with different fundamental units reflecting
the different geometric assumptions of Coxeter.4D (Euclidean) versus
Fuller.4D (synergetics) frameworks.}
\end{figure}

As shown in the following figure, the discrete Nelder--Mead converges on
plateaus; the previous figure summarizes the scaling behavior used in
volume diagnostics.

\begin{figure}
\centering
\includegraphics{../output/figures/simplex_final.png}
\caption{\textbf{Final converged simplex configuration in 3D embedding
space}. This 3D scatter plot shows the four vertices of the Nelder--Mead
simplex after 12 iterations of discrete optimization on the integer
Quadray lattice. \textbf{Points}: Four colored spheres representing the
final simplex vertices, each positioned at integer Quadray coordinates
projected to 3D space via the default embedding matrix. \textbf{Colors}:
Each vertex has a distinct color (blue, orange, green, red) for easy
identification. \textbf{Optimization context}: These vertices represent
the final state of the discrete Nelder--Mead algorithm after converging
to a local optimum on the integer lattice. The tight clustering of
vertices indicates successful convergence, with the simplex having
contracted around the optimal point. \textbf{Lattice constraints}: All
vertex positions correspond to integer Quadray coordinates,
demonstrating the discrete nature of the optimization. The final simplex
volume is minimal on the integer lattice, representing a stable
configuration where further discrete moves do not improve the objective
function. This visualization complements the time-series animation
(\passthrough{\lstinline!simplex\_animation.mp4!}) and the diagnostic
traces in the previous figure. The final simplex volume is minimal on
the integer lattice, representing a stable ``energy level'' where
further discrete moves do not improve the objective function.}
\end{figure}

Raw artifacts: the full trajectory animation
\passthrough{\lstinline!simplex\_animation.mp4!} and per-frame vertices
(\passthrough{\lstinline!simplex\_animation\_vertices.csv!}/\passthrough{\lstinline!.npz!})
are available in \passthrough{\lstinline!quadmath/output/!}. The full
optimization trajectory is provided as an animation (MP4) in the
repository's output directory.

\hypertarget{discrete-lattice-descent-information-theoretic-variant}{%
\subsection{Discrete Lattice Descent (Information-Theoretic
Variant)}\label{discrete-lattice-descent-information-theoretic-variant}}

\begin{itemize}
\tightlist
\item
  Integer-valued descent over the IVM using the 12 neighbor moves
  (permutations of \{2,1,1,0\}), snapping to the canonical
  representative via projective normalization.
\item
  Objective can be geometric (e.g., Euclidean in an embedding) or
  information-theoretic (e.g., local free-energy proxy); monotone
  decrease is guaranteed by greedy selection.
\item
  API: \passthrough{\lstinline!discrete\_ivm\_descent!} in
  \passthrough{\lstinline!src/discrete\_variational.py!}. Animation
  helper: \passthrough{\lstinline!animate\_discrete\_path!} in
  \passthrough{\lstinline!src/visualize.py!}.
\end{itemize}

Short snippet (paper reproducibility):

\begin{lstlisting}[language=Python]
from quadray import Quadray, DEFAULT_EMBEDDING, to_xyz
from discrete_variational import discrete_ivm_descent
from visualize import animate_discrete_path

def f(q: Quadray) -> float:
    x, y, z = to_xyz(q, DEFAULT_EMBEDDING)
    return (x - 0.5)**2 + (y + 0.2)**2 + (z - 0.1)**2

path = discrete_ivm_descent(f, Quadray(6,0,0,0))
animate_discrete_path(path)
\end{lstlisting}

\hypertarget{convergence-and-robustness}{%
\subsection{Convergence and
Robustness}\label{convergence-and-robustness}}

\begin{itemize}
\tightlist
\item
  Discrete steps reduce numerical drift; improved stability
  vs.~unconstrained Cartesian.
\item
  Natural regularization from volume quantization; fewer wasted
  evaluations.
\item
  Compatible with Gauss--Newton/Natural Gradient guidance using FIM for
  metric-aware steps (Amari, natural gradient).
\end{itemize}

\hypertarget{information-geometric-view-einstein.4d-analogy-in-metric-form}{%
\subsection{Information-Geometric View (Einstein.4D analogy in metric
form)}\label{information-geometric-view-einstein.4d-analogy-in-metric-form}}

\begin{itemize}
\tightlist
\item
  \textbf{Fisher Information as metric}: use the empirical estimator
  \passthrough{\lstinline!F = (1/N) \\sum g g^\\top!} from
  \passthrough{\lstinline!fisher\_information\_matrix!} to analyze
  curvature of the objective with respect to parameters. See
  \href{https://en.wikipedia.org/wiki/Fisher_information}{Fisher
  information}.
\item
  \textbf{Curvature directions}: leading eigenvalues/eigenvectors of
  \passthrough{\lstinline!F!} (see
  \passthrough{\lstinline!fim\_eigenspectrum!}) reveal stiff and sloppy
  directions; this supports step-size selection and preconditioning.
\item
  \textbf{Figures}: empirical FIM heatmap (see below) and eigenspectrum
  (see below). Raw data available as NPZ/CSV in
  \passthrough{\lstinline!quadmath/output/!}.
\end{itemize}

\begin{figure}
\centering
\includegraphics{../output/figures/fisher_information_matrix.png}
\caption{\textbf{Empirical Fisher Information Matrix (FIM) for noisy
linear regression}. This heatmap visualizes the 3×3 Fisher information
matrix \(F_{ij}\) estimated from per-sample gradients of a misspecified
linear regression model. \textbf{Matrix structure}: The FIM captures the
local curvature of the log-likelihood surface around the current
parameter estimate, with brighter colors indicating higher information
content. \textbf{Diagonal dominance}: The diagonal elements (F₀₀, F₁₁,
F₂₂) show the strongest information content, indicating that each
parameter contributes independently to the model's predictive power.
\textbf{Off-diagonal structure}: The off-diagonal elements reveal
parameter interactions and potential redundancy in the model
specification. \textbf{Optimization implications}: This FIM structure
guides natural gradient descent by weighting parameter updates according
to local curvature, leading to more efficient convergence than standard
gradient descent. The matrix is computed empirically from training data,
making it adaptive to the specific data distribution and current
parameter values. This empirical approach is particularly valuable when
the true data-generating process is unknown or when working with
complex, non-linear models where analytical FIM computation is
intractable.}
\end{figure}

\begin{figure}
\centering
\includegraphics{../output/figures/fisher_information_eigenspectrum.png}
\caption{\textbf{Fisher Information Matrix eigenspectrum: principal
curvature directions}. This bar chart displays the eigenvalue
decomposition of the empirical Fisher information matrix from the
previous figure, revealing the principal curvature directions of the
parameter manifold. \textbf{X-axis}: Eigenvalue indices (0, 1, 2) sorted
in descending order of magnitude. \textbf{Y-axis}: Eigenvalue magnitudes
representing the strength of curvature along each principal direction.
\textbf{Eigenvalue interpretation}: Larger eigenvalues indicate
directions of high curvature (tight constraints) where the objective
function changes rapidly with parameter changes. Smaller eigenvalues
indicate directions of low curvature (loose constraints) where the
objective function is relatively flat. \textbf{Optimization geometry}:
This eigenspectrum reveals the anisotropic nature of the parameter
space, explaining why natural gradient descent (which scales updates by
the inverse FIM) converges more efficiently than standard gradient
descent. The principal directions provide insight into which parameter
combinations are most sensitive to data changes and which are relatively
stable. This geometric understanding is crucial for designing effective
optimization strategies and understanding model behavior.}
\end{figure}

\begin{figure}
\centering
\includegraphics{../output/figures/natural_gradient_path.png}
\caption{\textbf{Natural gradient descent trajectory on a quadratic
objective (2D projection)}. This line plot with markers shows the
parameter trajectory of natural gradient descent converging to the
optimum of a quadratic objective function. \textbf{Trajectory}: The blue
line with markers traces the parameter evolution from initial guess to
final optimum, showing the path taken through the 2D parameter space.
\textbf{Markers}: Each marker represents one optimization step, with
spacing indicating the step size and convergence rate.
\textbf{Convergence behavior}: The trajectory shows smooth, direct
convergence to the optimum, characteristic of natural gradient descent
on well-conditioned objectives. \textbf{Comparison with standard
gradient descent}: Natural gradient descent typically produces more
direct trajectories than standard gradient descent, especially on
ill-conditioned problems where the parameter space has strong
anisotropy. This efficiency comes from the FIM-based scaling that adapts
step sizes to local curvature. The trajectory demonstrates how
information-geometric optimization leverages the intrinsic geometry of
the parameter space to achieve faster, more stable convergence than
naive gradient methods.}
\end{figure}

\begin{figure}
\centering
\includegraphics{../output/figures/free_energy_curve.png}
\caption{\textbf{Variational free energy landscape for a discrete
2-state system}. This curve shows the variational free energy
\(\mathcal{F} = -\log P(o|s) + \text{KL}[Q(s)||P(s)]\) (see Eq.
\eqref{eq:supp_free_energy}) as a function of the variational
distribution parameter. \textbf{X-axis}: Variational parameter
controlling the distribution over the two discrete states.
\textbf{Y-axis}: Free energy value in natural units. \textbf{Curve
shape}: The free energy exhibits a clear minimum at the optimal
variational distribution, representing the best approximation to the
true posterior given the constraints of the variational family.
\textbf{KL divergence component}: The free energy balances data fit
(first term) with regularization (KL divergence from prior), preventing
overfitting while maintaining good predictive performance.
\textbf{Optimization interpretation}: Minimizing this free energy
corresponds to finding the best variational approximation to the true
posterior, a fundamental task in Bayesian inference and active
inference. The smooth, convex shape of the free energy landscape makes
optimization straightforward using standard methods like gradient
descent or natural gradient descent. This variational framework provides
a principled approach to approximate inference in complex models where
exact posterior computation is intractable.}
\end{figure}

\begin{itemize}
\tightlist
\item
  \textbf{Quadray relevance}: block-structured and symmetric patterns
  often arise under quadray parameterizations, simplifying
  \passthrough{\lstinline!F!} inversion for natural-gradient steps.
\end{itemize}

\hypertarget{multi-objective-and-higher-dimensional-notes-coxeter.4d-perspective}{%
\subsection{Multi-Objective and Higher-Dimensional Notes (Coxeter.4D
perspective)}\label{multi-objective-and-higher-dimensional-notes-coxeter.4d-perspective}}

\begin{itemize}
\tightlist
\item
  Multi-objective: vertices encode trade-offs; simplex faces approximate
  Pareto surfaces; integer volume measures solution diversity.
\item
  Higher dimensions: decompose higher-dimensional simplexes into
  tetrahedra; sum integer volumes to extend quantization.
\end{itemize}

\hypertarget{external-validation-and-computational-context}{%
\subsection{External validation and computational
context}\label{external-validation-and-computational-context}}

The optimization methods developed here build upon and complement the
extensive computational framework in Kirby Urner's
\href{https://github.com/4dsolutions}{4dsolutions ecosystem}. For
comprehensive details on the computational implementations, educational
materials, and cross-language validation, see the
\href{07_resources.md}{Resources} section.

\hypertarget{results}{%
\subsection{Results}\label{results}}

\begin{itemize}
\tightlist
\item
  The simplex-based optimizer exhibits discrete volume plateaus and
  converges to low-spread configurations; see the simplex figure above
  and the MP4/CSV artifacts in
  \passthrough{\lstinline!quadmath/output/!}.
\item
  The greedy IVM descent produces monotone trajectories with
  integer-valued objectives; see the discrete descent figure below.
\end{itemize}

\end{document}
